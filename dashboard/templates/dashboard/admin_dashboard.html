{% extends 'dashboard/base.html' %}

{% block title %}Admin Dashboard - Rivo{% endblock %}

{% block content %}
<div class="page-header">
    <h1>All Clients</h1>
</div>

<div class="card">
    {% if clients %}
    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Stage</th>
                <th>Assigned To</th>
            </tr>
        </thead>
        <tbody>
            {% for client in clients %}
            <tr>
                <td><strong>{{ client.name|default:"-" }}</strong></td>
                <td>{{ client.email|default:"-" }}</td>
                <td>{{ client.phone|default:"-" }}</td>
                <td><span class="badge badge-{{ client.current_stage }}">{{ client.get_current_stage_display }}</span></td>
                <td>
                    {% if client.active_csm %}
                        {{ client.active_csm.get_full_name|default:client.active_csm.email }}
                    {% else %}
                        <form method="post" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="client_id" value="{{ client.id }}">
                            <select name="csm_id" class="form-select" style="width: auto; display: inline-block; padding: 0.3rem;" required>
                                <option value="">Assign to...</option>
                                {% for csm in csm_users %}
                                <option value="{{ csm.id }}">{{ csm.get_full_name|default:csm.email }}</option>
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn btn-primary" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;">Assign</button>
                        </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #7f8c8d; text-align: center; padding: 2rem;">No clients found.</p>
    {% endif %}
</div>
{% endblock %}
